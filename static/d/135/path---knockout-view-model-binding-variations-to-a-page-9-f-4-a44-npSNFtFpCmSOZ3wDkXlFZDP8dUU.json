{"data":{"site":{"siteMetadata":{"title":"Nadeem Khedr","author":"Nadeem Khedr"}},"markdownRemark":{"id":"08a0e7a5-6bb3-5e64-8ce1-32c544ea4707","excerpt":"Bind a  viewModel  to the whole page There are many variations to write the view model in knockout, for example if we are using a simple object as a view model…","html":"<h2>Bind a <em>viewModel</em> to the whole page</h2>\n<p>There are many variations to write the view model in knockout, for example if we are using a simple object as a view model we will have some problems with <em><span style=\"color:#800000;\">this, </span></em>we will examine the variations of how we would write our view model and why</p>\n<p>First of lets start with a simple example and how to write a simple* view model* and bind it to the page</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\">First name: <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>text<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">data-bind</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>value: firstName<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\nLast name: <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>text<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">data-bind</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>value: lastName<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h2</span><span class=\"token punctuation\">></span></span>Hello, <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\">data-bind</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>text: fullName <span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>!<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h2</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>And the Javascript file</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> <span class=\"token function-variable function\">User</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>firstName <span class=\"token operator\">=</span> ko<span class=\"token punctuation\">.</span><span class=\"token function\">observable</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Nadeem\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>lastName <span class=\"token operator\">=</span> ko<span class=\"token punctuation\">.</span><span class=\"token function\">observable</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Khedr\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>fullName <span class=\"token operator\">=</span> ko<span class=\"token punctuation\">.</span><span class=\"token function\">computed</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">firstName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\" \"</span> <span class=\"token operator\">+</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">lastName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\nko<span class=\"token punctuation\">.</span><span class=\"token function\">applyBindings</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>This will bind our javascript view model to the whole <em>html</em> document and every variable in the <em>databind</em> attributes wil refer to a property of this one view model</p>\n<h2>Bind a <em>viewModel</em> to a partial part of the page</h2>\n<p>In the previous example we passed our <code class=\"language-text\">viewModel</code> to <code class=\"language-text\">ko.applyBindings</code>, this method take another parameter, which is the <code class=\"language-text\">DOM</code> element that we want to attach our <code class=\"language-text\">viewModel</code> to, In the next example we will attach two different &#x26; not related <code class=\"language-text\">viewModel</code>s to different parts of our page</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>section1<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  First name: <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>text<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">data-bind</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>value: firstName<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n  Last name: <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>text<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">data-bind</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>value: lastName<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h2</span><span class=\"token punctuation\">></span></span>Hello, <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\">data-bind</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>text: fullName <span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>!<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h2</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>section2<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  First name: <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>text<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">data-bind</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>value: firstName<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n  Last name: <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>text<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">data-bind</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>value: lastName<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h2</span><span class=\"token punctuation\">></span></span>Hello, <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\">data-bind</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>text: fullName <span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>!<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h2</span><span class=\"token punctuation\">></span></span>\n <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> <span class=\"token function-variable function\">User</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>firstName<span class=\"token punctuation\">,</span>lastName<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>firstName <span class=\"token operator\">=</span> ko<span class=\"token punctuation\">.</span><span class=\"token function\">observable</span><span class=\"token punctuation\">(</span>firstName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>lastName <span class=\"token operator\">=</span> ko<span class=\"token punctuation\">.</span><span class=\"token function\">observable</span><span class=\"token punctuation\">(</span>lastName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>fullName <span class=\"token operator\">=</span> ko<span class=\"token punctuation\">.</span><span class=\"token function\">computed</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">firstName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\" \"</span> <span class=\"token operator\">+</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">lastName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\nko<span class=\"token punctuation\">.</span><span class=\"token function\">applyBindings</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Nadeem\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"Khedr\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#section1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nko<span class=\"token punctuation\">.</span><span class=\"token function\">applyBindings</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Phil\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"Joe\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#section2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2>Bind a <em>viewModel</em> to the whole page and bind other <em>viewModel</em>s to sections inside the page</h2>\n<p>In a more advanced scenario what we could want is to bind a viewModel to the whole page &#x26; sort of mini <code class=\"language-text\">viewModel</code>s to different reusable components inside the page</p>\n<p>In the previous example we cant define two <code class=\"language-text\">html</code> sections inside each other with different <code class=\"language-text\">viewModel</code>s, they must be distinct, in another word we can’t define a master view model for all the page and a small view model for a part of that page because they will collide</p>\n<h3>A scenario that we would want exactly that</h3>\n<ul>\n<li>We want a master <code class=\"language-text\">viewModel</code> to our page (Layout)</li>\n<li>We want a reusable <code class=\"language-text\">viewModel</code> for a sidebar that we could use in multiple pages (Partial View)</li>\n</ul>\n<p>To achieve that what we will do is go to the parent of the sidebar and tell it stop binding the page <code class=\"language-text\">viewModel</code> to your descendant elements</p>\n<p>so what will happen exactly is we will define a <code class=\"language-text\">viewModel</code> to the whole page without specifying a <em>DOM</em> element to attach it to, and another <em>view model</em> (maybe in another file) for only the sidebar and bind it to it</p>\n<h3>How to do that without getting errors that the properties in the sidebar doesn’t exists in the application <code class=\"language-text\">viewModel</code></h3>\n<p>We will put a custom attribute on the sidebar container, the attribute will look like this</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>sidebarCont<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">data-bind</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>allowBinding: false<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>what this will do is tell the current view model attached to the document to stop binding itself to the descendant elements for the <code class=\"language-text\">sidebarCont</code></p>\n<p>the <code class=\"language-text\">allowBinding</code> is a custom <code class=\"language-text\">bindingHandler</code> that we defined and looks like this</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">ko<span class=\"token punctuation\">.</span>bindingHandlers<span class=\"token punctuation\">.</span>allowBindings <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  init<span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>elem<span class=\"token punctuation\">,</span> valueAccessor<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> shouldAllowBindings<span class=\"token punctuation\">;</span>\n    shouldAllowBindings <span class=\"token operator\">=</span> ko<span class=\"token punctuation\">.</span>utils<span class=\"token punctuation\">.</span><span class=\"token function\">unwrapObservable</span><span class=\"token punctuation\">(</span><span class=\"token function\">valueAccessor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n      controlsDescendantBindings<span class=\"token punctuation\">:</span> <span class=\"token operator\">!</span>shouldAllowBindings\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>the above code is self explanatory all the magic happens with the <em><a href=\"http://knockoutjs.com/documentation/custom-bindings-controlling-descendant-bindings.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">controlsDescendantBindings</a></em></p>\n<blockquote>\n<p>if you want to read more about bindingHandlers you can check this <a href=\"http://knockoutjs.com/documentation/custom-bindings.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">link</a></p>\n</blockquote>","frontmatter":{"title":"Knockout view model binding variations to a page","date":"January 29, 2013"}}},"pageContext":{"slug":"knockout-view-model-binding-variations-to-a-page/","previous":{"fields":{"slug":"how-the-unobtrusive-jquery-validate-plugin-works-internally-in-asp-net-mvc/"},"frontmatter":{"title":"How the unobtrusive jQuery validate plugin works internally in Asp.net MVC"}},"next":{"fields":{"slug":"asp-net-mvc-jsonresult-anonymous-types-and-testing/"},"frontmatter":{"title":"Asp.net MVC JsonResult, Anonymous types and Testing"}}}}