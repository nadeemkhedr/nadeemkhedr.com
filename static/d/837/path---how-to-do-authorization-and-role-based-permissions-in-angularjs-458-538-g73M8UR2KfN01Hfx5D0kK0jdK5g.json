{"data":{"site":{"siteMetadata":{"title":"Nadeem Khedr","author":"Nadeem Khedr"}},"markdownRemark":{"id":"44a13543-82a4-50de-8155-f7d6aef41b20","excerpt":"We will be adding 3 Layer to implement Authorization in our app UI manipulation  (Showing or hiding part of the screens based on the user permission) Routing…","html":"<h2>We will be adding 3 Layer to implement Authorization in our app</h2>\n<ul>\n<li>UI manipulation <em>(Showing or hiding part of the screens based on the user permission)</em></li>\n<li>Routing <em>(When the user access a route that he doesn’t have permission to will redirect him to an error  route)</em></li>\n<li>Http Interceptor <em>(We will Setup an interceptor that will check when the server returns <code class=\"language-text\">401</code> or <code class=\"language-text\">403</code> and will redirect the user to an error route)</em></li>\n</ul>\n<h2>How will we implement it ?</h2>\n<ol>\n<li>We want to get all the user permissions before loading our app <em>(more like a resolve but for every route)</em></li>\n<li>then we will store it <em>(using a service)</em></li>\n<li>for showing/hiding sections of our app that require special permissions we will use a directive for that</li>\n<li>Then when we define a route we will add an extra parameter <code class=\"language-text\">permission</code> and give it a value for the permission that it requires</li>\n<li>then after that we will check in a <code class=\"language-text\">routeChangeStart</code> event to check if the user has permissions for that route <em>(if any)</em>,</li>\n<li>lastly we will set an http interceptor &#x26; read the respond status codes if its  <code class=\"language-text\">401</code> or <code class=\"language-text\">403</code> we will redirect the user to an error page</li>\n</ol>\n<p>Its a long list, so lets get starting</p>\n<h2>How to run the angular app in run time</h2>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> permissionList<span class=\"token punctuation\">;</span>\nangular<span class=\"token punctuation\">.</span><span class=\"token function\">element</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">ready</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  $<span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/api/UserPermission'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    permissionList <span class=\"token operator\">=</span> data<span class=\"token punctuation\">;</span>\n    angular<span class=\"token punctuation\">.</span><span class=\"token function\">bootstrap</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'myApp'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3>Why would you want to do that ?</h3>\n<p><em>And why use jQuery ? isn’t it evil to do that</em></p>\n<p>We are doing this because we want to get all the permissions before firing up the angular app <em>(Like a <a href=\"http://docs.angularjs.org/api/ngRoute.$routeProvider%22%20Angular%20Route%22\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">resolve</a> method for every route)</em></p>\n<p>We want to get all the users’ permissions that we will be using as the base for running all the permissions logic</p>\n<p>And we are using <code class=\"language-text\">$.ajax</code> because the app at that point is not loaded so we can’t use angular services</p>\n<h3>How we are using the data returned ?</h3>\n<p>Lets see an extended version of the code</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">//app.js</span>\n<span class=\"token keyword\">var</span> app <span class=\"token operator\">=</span> angular<span class=\"token punctuation\">.</span><span class=\"token function\">module</span><span class=\"token punctuation\">(</span><span class=\"token string\">'myApp'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> permissionList<span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>permissions<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  permissions<span class=\"token punctuation\">.</span><span class=\"token function\">setPermissions</span><span class=\"token punctuation\">(</span>permissionList<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nangular<span class=\"token punctuation\">.</span><span class=\"token function\">element</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">ready</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  $<span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/api/UserPermission'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    permissionList <span class=\"token operator\">=</span> data<span class=\"token punctuation\">;</span>\n    angular<span class=\"token punctuation\">.</span><span class=\"token function\">bootstrap</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'myApp'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">//permissions.js</span>\nangular<span class=\"token punctuation\">.</span><span class=\"token function\">module</span><span class=\"token punctuation\">(</span><span class=\"token string\">'myApp'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">factory</span><span class=\"token punctuation\">(</span><span class=\"token string\">'permissions'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span>$rootScope<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> permissionList<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n      setPermissions<span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>permissions<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        permissionList <span class=\"token operator\">=</span> permissions<span class=\"token punctuation\">;</span>\n        $rootScope<span class=\"token punctuation\">.</span><span class=\"token function\">$broadcast</span><span class=\"token punctuation\">(</span><span class=\"token string\">'permissionsChanged'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>What we are doing is after getting the permissions returned from the server is call <code class=\"language-text\">setPermissions</code> on the <code class=\"language-text\">permissions</code> service that will do two things:</p>\n<ul>\n<li>Save the permission list passed to it to an in memory variable</li>\n<li>Broadcast an event that will be listened by our custom directive to re-render it if the permissions changed</li>\n</ul>\n<h2>How to show/hide UI elements based on the user permissions</h2>\n<p>In this part we will be building a directive that will show &#x26; hide elements based  on the user permissions, lets get started by seeing an example of what we want to achieve</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>!–</span> <span class=\"token attr-name\">If</span> <span class=\"token attr-name\">the</span> <span class=\"token attr-name\">user</span> <span class=\"token attr-name\">has</span> <span class=\"token attr-name\">edit</span> <span class=\"token attr-name\">permission</span> <span class=\"token attr-name\">the</span> <span class=\"token attr-name\">show</span> <span class=\"token attr-name\">a</span> <span class=\"token attr-name\">link</span> <span class=\"token attr-name\">–</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">has-permission</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">'</span>Edit<span class=\"token punctuation\">'</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>/#/courses/{{ id }}/edit<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>{{ name }}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">has-permission</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">'</span>!Edit<span class=\"token punctuation\">'</span></span><span class=\"token punctuation\">></span></span>\n  {{ name }}\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>As seen in the example above we are using <code class=\"language-text\">has-permission</code> and passing it the permission name, or if we want to check if the user doesn’t have a permission we will prepend it with <code class=\"language-text\">!</code></p>\n<p>How its implemented</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">//hasPermission.js</span>\nangular<span class=\"token punctuation\">.</span><span class=\"token function\">module</span><span class=\"token punctuation\">(</span><span class=\"token string\">'myApp'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">directive</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hasPermission'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>permissions<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    link<span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>scope<span class=\"token punctuation\">,</span> element<span class=\"token punctuation\">,</span> attrs<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>_<span class=\"token punctuation\">.</span><span class=\"token function\">isString</span><span class=\"token punctuation\">(</span>attrs<span class=\"token punctuation\">.</span>hasPermission<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">throw</span> <span class=\"token string\">'hasPermission value must be a string'</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token keyword\">var</span> value <span class=\"token operator\">=</span> attrs<span class=\"token punctuation\">.</span>hasPermission<span class=\"token punctuation\">.</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">var</span> notPermissionFlag <span class=\"token operator\">=</span> value<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">===</span> <span class=\"token string\">'!'</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>notPermissionFlag<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        value <span class=\"token operator\">=</span> value<span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n\n      <span class=\"token keyword\">function</span> <span class=\"token function\">toggleVisibilityBasedOnPermission</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">var</span> hasPermission <span class=\"token operator\">=</span> permissions<span class=\"token punctuation\">.</span><span class=\"token function\">hasPermission</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>hasPermission <span class=\"token operator\">&amp;&amp;</span> <span class=\"token operator\">!</span>notPermissionFlag <span class=\"token operator\">||</span> <span class=\"token operator\">!</span>hasPermission <span class=\"token operator\">&amp;&amp;</span> notPermissionFlag<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          element<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>display <span class=\"token operator\">=</span> <span class=\"token string\">'block'</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n          element<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>display <span class=\"token operator\">=</span> <span class=\"token string\">'none'</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n\n      <span class=\"token function\">toggleVisibilityBasedOnPermission</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      scope<span class=\"token punctuation\">.</span><span class=\"token function\">$on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'permissionsChanged'</span><span class=\"token punctuation\">,</span> toggleVisibilityBasedOnPermission<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">//permissions.js</span>\nangular<span class=\"token punctuation\">.</span><span class=\"token function\">module</span><span class=\"token punctuation\">(</span><span class=\"token string\">'myApp'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">.</span><span class=\"token function\">factory</span><span class=\"token punctuation\">(</span><span class=\"token string\">'permissions'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>$rootScope<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> permissionList <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    setPermissions<span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>permissions<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      permissionList <span class=\"token operator\">=</span> permissions<span class=\"token punctuation\">;</span>\n      $rootScope<span class=\"token punctuation\">.</span><span class=\"token function\">$broadcast</span><span class=\"token punctuation\">(</span><span class=\"token string\">'permissionsChanged'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    hasPermission<span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span>permission<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      permission <span class=\"token operator\">=</span> permission<span class=\"token punctuation\">.</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">return</span> permissionList<span class=\"token punctuation\">.</span><span class=\"token function\">some</span><span class=\"token punctuation\">(</span>item <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> item<span class=\"token punctuation\">.</span>Name <span class=\"token operator\">!==</span> <span class=\"token string\">'string'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// item.Name is only used because when I called setPermission, I had a Name property</span>\n          <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">return</span> item<span class=\"token punctuation\">.</span>Name<span class=\"token punctuation\">.</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> permission<span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>The <code class=\"language-text\">has-permission</code> is pretty straight forward, it checks if the permission starts with <code class=\"language-text\">!</code> then checks to see if the permission name is found in the permissions list by calling <code class=\"language-text\">hasPermission</code> on the <code class=\"language-text\">permissions</code> service</p>\n<h2>Permissions on Routes</h2>\n<p>What we have done so far is hiding the parts of the UI that the user doesn’t have access to, another part is putting permissions on the angular routes itself, so if the user writes the url by hand the permissions will still work</p>\n<h3>How will we do that ?</h3>\n<p>When we define a route we will add an extra parameter <code class=\"language-text\">permission</code> and give it a value for the permission that it requires then after that we will test in a <code class=\"language-text\">routeChangeStart</code> event to check if the user has permissions for that route</p>\n<p>Example of defining a route</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">//app.js</span>\n<span class=\"token keyword\">var</span> app <span class=\"token operator\">=</span> angular<span class=\"token punctuation\">.</span><span class=\"token function\">module</span><span class=\"token punctuation\">(</span><span class=\"token string\">'myApp'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> permissionList<span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">config</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span>$routeProvider<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  $routeProvider\n    <span class=\"token punctuation\">.</span><span class=\"token function\">when</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n      templateUrl<span class=\"token punctuation\">:</span> <span class=\"token string\">'views/viewCourses.html'</span><span class=\"token punctuation\">,</span>\n      controller<span class=\"token punctuation\">:</span> <span class=\"token string\">'viewCoursesCtrl'</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">when</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/unauthorized'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n      templateUrl<span class=\"token punctuation\">:</span> <span class=\"token string\">'views/error.html'</span><span class=\"token punctuation\">,</span>\n      controller<span class=\"token punctuation\">:</span> <span class=\"token string\">'ErrorCtrl'</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">when</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/courses/:id/edit'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n      templateUrl<span class=\"token punctuation\">:</span> <span class=\"token string\">'views/editCourses.html'</span><span class=\"token punctuation\">,</span>\n      controller<span class=\"token punctuation\">:</span> <span class=\"token string\">'editCourses'</span><span class=\"token punctuation\">,</span>\n      permission<span class=\"token punctuation\">:</span> <span class=\"token string\">'Edit'</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>permissions<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  permissions<span class=\"token punctuation\">.</span><span class=\"token function\">setPermissions</span><span class=\"token punctuation\">(</span>permissionList<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nangular<span class=\"token punctuation\">.</span><span class=\"token function\">element</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">ready</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  $<span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/api/UserPermission'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    permissionList <span class=\"token operator\">=</span> data<span class=\"token punctuation\">;</span>\n    angular<span class=\"token punctuation\">.</span><span class=\"token function\">bootstrap</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'myApp'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">//mainApp.js (Parent controller used everywhere)</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">controller</span><span class=\"token punctuation\">(</span><span class=\"token string\">'mainAppCtrl'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>$scope<span class=\"token punctuation\">,</span> $location<span class=\"token punctuation\">,</span> permissions<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  $scope<span class=\"token punctuation\">.</span><span class=\"token function\">$on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'$routeChangeStart'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>scope<span class=\"token punctuation\">,</span> next<span class=\"token punctuation\">,</span> current<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> permission <span class=\"token operator\">=</span> next<span class=\"token punctuation\">.</span>$$route<span class=\"token punctuation\">.</span>permission<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>_<span class=\"token punctuation\">.</span><span class=\"token function\">isString</span><span class=\"token punctuation\">(</span>permission<span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token operator\">!</span>permissions<span class=\"token punctuation\">.</span><span class=\"token function\">hasPermission</span><span class=\"token punctuation\">(</span>permission<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      $location<span class=\"token punctuation\">.</span><span class=\"token function\">path</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/unauthorized'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2>Http Interceptor for checking unauthorized response from the server</h2>\n<p>This is also straight forward, we are just hooking up an interceptor that will read the response status code, if its <code class=\"language-text\">401</code> or <code class=\"language-text\">403</code> it will redirect it to <code class=\"language-text\">unauthorized</code> page</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">angular<span class=\"token punctuation\">.</span><span class=\"token function\">module</span><span class=\"token punctuation\">(</span><span class=\"token string\">'myApp'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">.</span><span class=\"token function\">factory</span><span class=\"token punctuation\">(</span><span class=\"token string\">'authInterceptor'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>$q<span class=\"token punctuation\">,</span> $location<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">responseError</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">.</span>status <span class=\"token operator\">===</span> <span class=\"token number\">401</span> <span class=\"token operator\">||</span> response<span class=\"token punctuation\">.</span>status <span class=\"token operator\">===</span> <span class=\"token number\">403</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        $location<span class=\"token punctuation\">.</span><span class=\"token function\">path</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/unauthorized'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token keyword\">return</span> $q<span class=\"token punctuation\">.</span><span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">.</span><span class=\"token function\">config</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>$httpProvider<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  $httpProvider<span class=\"token punctuation\">.</span>interceptors<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token string\">'authInterceptor'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>That’s about it as you can see its pretty easy to implement and customize, hope this post helps, if you have any questions or something you see can be done better then please leave me a comment</p>","frontmatter":{"title":"How to do Authorization and Role  based permissions in AngularJs","date":"November 25, 2013"}}},"pageContext":{"slug":"how-to-do-authorization-and-role-based-permissions-in-angularjs/","previous":{"fields":{"slug":"angularjs-good-unit-test-structure-for-controllers/"},"frontmatter":{"title":"AngularJs Good Unit Test Structure For Controllers & How to test ajax code and Promises"}},"next":{"fields":{"slug":"angularjs-scroll-to-element-using-directives/"},"frontmatter":{"title":"AngularJs Scroll to element using directives"}}}}